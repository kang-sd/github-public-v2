<!-- index.html - GitHub Public -->
<!-- ğŸ”“ ê³µê°œ: HTML êµ¬ì¡° + CSS + ì…ë ¥í¼ -->
<!-- ğŸ”’ ë¹„ê³µê°œ: ë¡œì§ì€ Firebase Functionsì—ì„œ ë™ì  ë¡œë“œ -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‚¬ì£¼íŒ”ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="main-container">

    <!-- ì…ë ¥ í¼ ì˜ì—­ -->
    <div id="form-section">
      <div id="block1-container"></div>
      <div id="form-container"></div>
    </div>

    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="result-section" style="display:none; margin-top:30px;">
      <div id="block2-container"></div>
      <div id="block3-container"></div>
    </div>

    <!-- í•˜ë‹¨ ì•ˆë‚´ë¬¸êµ¬ -->
    <div id="footer-message" style="margin-top:50px; font-size:13px; color:#444; text-align:center; line-height:1.8;
         border-top:2px solid #1976d2; padding:18px; background:#f9fbff; border-radius:8px;">
      <p style="font-size:14px; font-weight:bold; color:#1976d2; margin-bottom:8px;">ğŸ“Œ ì´ìš© ì•ˆë‚´</p>
      <p style="margin:6px 0;">
        ë³¸ ì‚¬ì£¼íŒ”ì í”„ë¡œê·¸ë¨ì€ <b style="color:#000;">kangseoungdo</b>ì— ì €ì‘ê¶Œì´ ìˆìœ¼ë©°,<br>
        <span style="color:#d32f2f; font-weight:600;">ìƒì—…ì  ì‚¬ìš© ë° ë¬´ë‹¨ ë°°í¬ëŠ” ê¸ˆì§€</span>ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
      </p>
      <p style="margin:6px 0;">
        ì…ë ¥ëœ ê°œì¸ì •ë³´(ì´ë¦„, ìƒë…„ì›”ì¼, ì¶œìƒì§€ ë“±)ëŠ” ì˜¤ì§ <b>í•´ì„ ëª©ì </b>ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
      </p>
      <p style="margin:6px 0; font-style:italic; color:#666;">
        âš ï¸ ë³¸ í•´ì„ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œ ì œê³µë˜ë©°, ë²•ì  íš¨ë ¥ì´ë‚˜ ì ˆëŒ€ì  ì§„ì‹¤ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
      <p style="margin:6px 0;">
        ë³¸ í”„ë¡œê·¸ë¨ì€ PC, ëª¨ë°”ì¼, íƒœë¸”ë¦¿ ë“± ì–´ëŠ í™˜ê²½ì—ì„œë“  ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
        ë‹¤ë§Œ <b style="color:#1976d2;">íƒœë¸”ë¦¿ ì‚¬ìš©ì„ ê¶Œì¥</b>í•©ë‹ˆë‹¤.
      </p>
      <p style="margin:6px 0; font-size:13px; color:#555;">
        âœ‰ï¸ ì´ìš© ì¤‘ ë¶ˆí¸ì‚¬í•­ì€
        <a href="mailto:seoungdo@gmail.com" style="color:#1976d2; text-decoration:none; font-weight:500;">
          seoungdo@gmail.com
        </a> ìœ¼ë¡œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
      </p>
    </div>

  </div>

  <script>
    // âœ… [ìˆ˜ì • 1] window ì „ì—­ìœ¼ë¡œ ë“±ë¡ (constëŠ” windowì— ë¶™ì§€ ì•ŠìŒ)
    window.FIREBASE_API = 'https://us-central1-saju-app-bdd75.cloudfunctions.net';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        // âœ… [ìˆ˜ì • 2] google.script.run í˜¸í™˜ shim ê°€ì¥ ë¨¼ì € ë¡œë“œ
        await loadTemplateIntoHead('google-shim');

        // block1 (ì†Œê°œ) ë¡œë“œ
        const block1 = await fetch(`${window.FIREBASE_API}/getTemplate?name=block1`);
        document.getElementById('block1-container').innerHTML = await block1.text();

        // ì…ë ¥ í¼ ë¡œë“œ
        const formHTML = await fetch(`${window.FIREBASE_API}/getTemplate?name=input-form`);
        document.getElementById('form-container').innerHTML = await formHTML.text();

        // âœ… [ìˆ˜ì • 3] block2 (íƒ­ ë„¤ë¹„ê²Œì´ì…˜) ë¡œë“œ - ê¸°ì¡´ ì½”ë“œì—ì„œ ëˆ„ë½ë˜ì–´ ìˆì—ˆìŒ
        const block2 = await fetch(`${window.FIREBASE_API}/getTemplate?name=block2`);
        document.getElementById('block2-container').innerHTML = await block2.text();

        // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ
        await loadScripts();

      } catch (error) {
        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        document.body.insertAdjacentHTML('afterbegin',
          `<div style="background:#ffebee;padding:16px;color:#c62828;border-radius:8px;margin:16px;">
            âŒ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨: ${error.message}<br>
            <small>Firebase Functionsê°€ ë°°í¬ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</small>
          </div>`
        );
      }
    });

    // í…œí”Œë¦¿ì„ &lt;head&gt;ì— ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚½ì… (shim ì „ìš©)
    async function loadTemplateIntoHead(name) {
      const response = await fetch(`${window.FIREBASE_API}/getTemplate?name=${name}`);
      const html = await response.text();
      const div = document.createElement('div');
      div.innerHTML = html;
      const scriptTags = div.querySelectorAll('script');
      for (const oldScript of scriptTags) {
        await new Promise((resolve) => {
          const newScript = document.createElement('script');
          newScript.textContent = oldScript.textContent;
          newScript.onload = resolve;
          newScript.onerror = resolve;
          document.head.appendChild(newScript);
          if (!oldScript.src) resolve(); // inline scriptëŠ” ì¦‰ì‹œ ì‹¤í–‰
        });
      }
    }

    // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ í•¨ìˆ˜
    async function loadScripts() {
      const scripts = [
        // âœ… [ìˆ˜ì • 4] script_ui-firebase ì‚¬ìš© (êµ¬ë²„ì „ script_ui ëŒ€ì‹ )
        'script_ui-firebase',
        'script_block3',
        'script_block3_1',
        'script_block3_2',
        'script_block3_4',
        'script_block4',
        // âœ… [ìˆ˜ì • 5] ì†Œë¬¸ì d (script_block4_daewoon) - ê¸°ì¡´ Daewoonì€ 404ì˜€ìŒ
        'script_block4_daewoon',
        'script_block4_sewoon',
        'script_block6',
        'script_block7'
      ];

      for (const scriptName of scripts) {
        try {
          const response = await fetch(`${window.FIREBASE_API}/getTemplate?name=${scriptName}`);
          if (!response.ok) {
            console.warn(`[loadScripts] í…œí”Œë¦¿ ${scriptName} ë¡œë“œ ì‹¤íŒ¨: HTTP ${response.status}`);
            continue;
          }
          const scriptHTML = await response.text();

          // <script> íƒœê·¸ ì¶”ì¶œ ë° ì‹¤í–‰ (HTMLë„ bodyì— ì¶”ê°€)
          const div = document.createElement('div');
          div.innerHTML = scriptHTML;

          // HTML ìš”ì†Œ(ìŠ¤íƒ€ì¼ ë“±)ëŠ” bodyì— ì¶”ê°€
          div.querySelectorAll('style').forEach(el => {
            document.head.appendChild(el.cloneNode(true));
          });

          // ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì‹¤í–‰
          const scriptTags = div.querySelectorAll('script');
          for (const oldScript of scriptTags) {
            await new Promise((resolve) => {
              const newScript = document.createElement('script');
              if (oldScript.src) {
                newScript.src = oldScript.src;
                newScript.onload = resolve;
                newScript.onerror = resolve;
              } else {
                newScript.textContent = oldScript.textContent;
                newScript.onload = resolve;
                newScript.onerror = resolve;
              }
              document.body.appendChild(newScript);
              if (!oldScript.src) resolve();
            });
          }
          console.log(`[loadScripts] âœ… ${scriptName} ë¡œë“œ ì™„ë£Œ`);
        } catch (err) {
          console.error(`[loadScripts] ${scriptName} ì˜¤ë¥˜:`, err);
        }
      }
    }
  </script>

</body>
</html>
