<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‚¬ì£¼íŒ”ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #fff;
      color: #000;
      font-size: 18px;
      display: flex;
      justify-content: center;
      margin: 0;
      padding: 20px;
    }
    .section-title {
      color: #222;
      font-weight: 700;
      font-size: 22px;
      text-align: center;
      margin: 20px 0 16px;
      padding: 10px;
      background: #f5f8ff;
      border-radius: 8px;
      border-bottom: 3px solid #1976d2;
    }
    .block-btn-main {
      background: #1976d2;
      color: #fff;
      border-radius: 6px;
      padding: 10px 16px;
      font-weight: bold;
      font-size: 15px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .block-btn-main:hover {
      background: #1565c0;
    }
    .block-btn-main.active {
      background: #0d47a1;
    }
    .block-btn-sub {
      background: #f0f0f0;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .block-btn-sub:hover {
      background: #dcedc8;
      border-color: #8bc34a;
    }
    .block-btn-sub.active {
      background: #2e7d32;
      color: #fff;
      border-color: #1b5e20;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0;
    }
    .form-table {
      width: 100%;
      max-width: 640px;
      margin: 0 auto;
      border-collapse: separate;
      border-spacing: 8px 12px;
      font-size: 16px;
    }
    .form-table td {
      padding: 6px;
      vertical-align: middle;
    }
    .form-table input[type="text"],
    .form-table select {
      width: 100%;
      padding: 10px 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .form-table input[type="radio"],
    .form-table input[type="checkbox"] {
      transform: scale(1.2);
      margin-right: 5px;
    }
    .form-table label {
      margin-right: 12px;
      font-weight: 400;
      font-size: 15px;
    }
    .main-container {
      background-color: rgba(245, 245, 245, 0.95);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 100%;
      max-width: 700px;
    }
    .main-button {
      background-color: #007bff;
      color: white;
      padding: 12px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
      box-sizing: border-box;
    }
    .main-button:hover {
      background-color: #0056b3;
    }
    .small-button {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      margin: 4px;
    }
    .small-button:hover {
      background-color: #0056b3;
    }
    .header-row { background-color: #e0f7fa; color: #000; font-weight: bold; }
    .siseong-row { background-color: #fef9e7; color: #333; }
    .sigak-row { background-color: #f2f2f2; color: #333; }
    .jijanggan-row { background-color: #e8f5e9; color: #222; }
    table {
      border-collapse: collapse;
      width: 100%;
      font-family: 'Noto Sans KR', sans-serif;
      font-size: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: center;
    }
    .result-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 1px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      font-family: 'Noto Sans KR', sans-serif;
      font-size: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .result-table th {
      background-color: #f0f4f8;
      color: #333;
      text-align: center;
      padding: 10px 12px;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
    }
    .result-table td {
      background-color: #ffffff;
      color: #222;
      padding: 10px 12px;
      text-align: left;
      vertical-align: top;
      border-bottom: 1px solid #eee;
      line-height: 1.5;
    }
    .hidden {
      display: none;
    }
    .hidden-option {
      display: none;
    }
    .solar-guide {
      color: #1976d2;
      font-weight: 600;
      font-size: 14px;
      margin-left: 8px;
    }
    #loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    #loading-overlay.show {
      display: flex;
    }
    .loading-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay">
    <div class="loading-content">
      <h2>â³ ë¡œë”© ì¤‘...</h2>
      <p id="loading-status">í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>
  </div>

  <div class="main-container">
    <!-- âœ… ì…ë ¥ í¼ ì˜ì—­ -->
    <div id="form-section">
      <h2 class="section-title"><span id="title-star" style="cursor:pointer;">ğŸŒŸ</span> ì‚¬ì£¼íŒ”ì ì…ë ¥ âš¡</h2>
      <table class="form-table">
        <tr>
          <td><label for="name">ì´ë¦„:</label></td>
          <td colspan="2"><input type="text" placeholder="í™ê¸¸ë™" id="name" maxlength="10" /></td>
        </tr>
        <tr>
          <td><label>ì„±ë³„:</label></td>
          <td colspan="2">
            <label><input type="radio" id="female" name="gender" value="ì—¬ì" checked />ì—¬ì</label>
            <label><input type="radio" id="male" name="gender" value="ë‚¨ì" />ë‚¨ì</label>
          </td>
        </tr>
        <tr>
          <td><label for="birthDate">ìƒë…„ì›”ì¼:</label></td>
          <td colspan="2">
            <input type="text" placeholder="19900101" id="birthDate" maxlength="8" />
            <label class="hidden-option"><input type="checkbox" id="lunar" />ìŒë ¥</label>
            <label class="hidden-option"><input type="checkbox" id="leapMonth" />ìœ¤ë‹¬</label>
            <span class="solar-guide">ğŸŒ ì–‘ë ¥ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”</span>
          </td>
        </tr>
        <tr>
          <td><label for="birthTime">ì¶œìƒì‹œê°„:</label></td>
          <td colspan="2">
            <input type="text" placeholder="1330" id="birthTime" maxlength="4" />
            <label class="hidden-option"><input type="checkbox" id="noBirthTime" />ëª¨ë¦„</label>
          </td>
        </tr>
        <tr>
          <td><label for="birth-si">ì¶œìƒì§€:</label></td>
          <td>
            <select id="birth-si" onchange="updateGunOptions()" required>
              <option value="">-- ì‹œë„ ì„ íƒ --</option>
            </select>
          </td>
          <td>
            <select id="birth-gun" required>
              <option value="">-- êµ¬/êµ° ì„ íƒ --</option>
            </select>
          </td>
        </tr>
      </table>

      <input type="hidden" id="inName">

      <div id="error-message" style="color:red; text-align:center; margin-top:10px; display:none;"></div>
      <div id="loading-message" style="display:none; text-align:center; margin-top:20px; font-weight:bold; color:#0066cc;">
        â³ ì‚¬ì£¼íŒ”ìë¥¼ êµ¬ì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”
      </div>

      <div id="name-box" style="margin-top:16px; padding:16px; border:1px solid #ccc; border-radius:8px; background:#f7f7f7; display:none; flex-wrap:wrap; gap:8px;"></div>

      <div style="margin-top:20px; display:flex; gap:12px;">
        <button class="main-button" onclick="submitToSheet()">ì‚¬ì£¼íŒ”ì ì‹œì‘í•˜ê¸°</button>
      </div>

      <div id="user-search" style="margin-top:20px; display:flex; gap:8px;">
        <input type="text" id="search-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
               style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:6px;">
        <button class="main-button" onclick="searchResultByName()">ğŸ” ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰</button>
      </div>

      <div id="search-result-box" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:8px;"></div>
    </div>

    <!-- âœ… ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="result-section" style="display:none; margin-top:30px;">
      <div id="block1-container"></div>
      <div id="block2-container"></div>
    </div>

    <!-- âœ… í•˜ë‹¨ ì•ˆë‚´ë¬¸êµ¬ -->
    <div id="footer-message" style="margin-top:50px; font-size:13px; color:#444; text-align:center; line-height:1.8; 
         border-top:2px solid #1976d2; padding:18px; background:#f9fbff; border-radius:8px;">
      
      <p style="font-size:14px; font-weight:bold; color:#1976d2; margin-bottom:8px;">
        ğŸ“Œ ì´ìš© ì•ˆë‚´
      </p>

      <p style="margin:6px 0;">
        ë³¸ ì‚¬ì£¼ ì‚¬ì£¼íŒ”ì í”„ë¡œê·¸ë¨ì€ <b style="color:#000;">kangseoungdo</b>ì— ì €ì‘ê¶Œì´ ìˆìœ¼ë©°,<br>
        <span style="color:#d32f2f; font-weight:600;">ìƒì—…ì  ì‚¬ìš© ë° ë¬´ë‹¨ ë°°í¬ëŠ” ê¸ˆì§€</span>ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
      </p>

      <p style="margin:6px 0;">
        ì…ë ¥ëœ ê°œì¸ì •ë³´(ì´ë¦„, ìƒë…„ì›”ì¼, ì¶œìƒì§€ ë“±)ëŠ” ì˜¤ì§ <b>í•´ì„ ëª©ì </b>ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°,<br>
        ë‹¤ë¥¸ ìš©ë„ë¡œ ì €ì¥Â·í™œìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>

      <p style="margin:6px 0; font-style:italic; color:#666;">
        âš ï¸ ë³¸ í•´ì„ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œ ì œê³µë˜ë©°, ë²•ì  íš¨ë ¥ì´ë‚˜ ì ˆëŒ€ì  ì§„ì‹¤ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        ëª¨ë“  íŒë‹¨ê³¼ ì±…ì„ì€ ì´ìš©ì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
      </p>

      <p style="margin:6px 0;">
        ë³¸ í”„ë¡œê·¸ë¨ì€ PC, ëª¨ë°”ì¼, íƒœë¸”ë¦¿ ë“± <b>ì–´ëŠ í™˜ê²½ì—ì„œë“  ì‚¬ìš© ê°€ëŠ¥</b>í•©ë‹ˆë‹¤.<br>
        ë‹¤ë§Œ, í™”ë©´ í¬ê¸°ì™€ ê°€ë…ì„±ì„ ê³ ë ¤í•˜ì—¬ <b style="color:#1976d2;">íƒœë¸”ë¦¿ ì‚¬ìš©ì„ ê¶Œì¥</b>í•©ë‹ˆë‹¤.
      </p>

      <p style="margin:6px 0; font-size:13px; color:#555;">
        âœ‰ï¸ ì´ìš© ì¤‘ ë¶ˆí¸ì‚¬í•­ì€ 
        <a href="mailto:seoungdo@gmail.com" style="color:#1976d2; text-decoration:none; font-weight:500;">
          seoungdo@gmail.com
        </a> ìœ¼ë¡œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- âœ… Firebase ì—°ë™ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // Firebase Functions API ì„¤ì •
    const FIREBASE_API = 'https://us-central1-saju-app-bdd75.cloudfunctions.net';

    // ì¶œìƒì§€ ë°ì´í„°
    const birthPlaceData = {
      "ê°•ì›ë„": ["ì¶˜ì²œì‹œ", "ì›ì£¼ì‹œ", "ê°•ë¦‰ì‹œ", "ë™í•´ì‹œ", "íƒœë°±ì‹œ", "ì†ì´ˆì‹œ", "ì‚¼ì²™ì‹œ", "í™ì²œêµ°", "íš¡ì„±êµ°", "ì˜ì›”êµ°", "í‰ì°½êµ°", "ì •ì„ êµ°", "ì² ì›êµ°", "í™”ì²œêµ°", "ì–‘êµ¬êµ°", "ì¸ì œêµ°", "ê³ ì„±êµ°", "ì–‘ì–‘êµ°"],
      "ê²½ê¸°ë„": ["ìˆ˜ì›ì‹œ", "ì„±ë‚¨ì‹œ", "ê³ ì–‘ì‹œ", "ìš©ì¸ì‹œ", "ë¶€ì²œì‹œ", "ì•ˆì‚°ì‹œ", "ì•ˆì–‘ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "í™”ì„±ì‹œ", "í‰íƒì‹œ", "ì˜ì •ë¶€ì‹œ", "íŒŒì£¼ì‹œ", "ì‹œí¥ì‹œ", "ê¹€í¬ì‹œ", "ê´‘ì£¼ì‹œ", "ì´ì²œì‹œ", "ì–‘ì£¼ì‹œ", "êµ¬ë¦¬ì‹œ", "ì˜¤ì‚°ì‹œ", "í•˜ë‚¨ì‹œ", "ì—¬ì£¼ì‹œ", "ì–‘í‰êµ°", "ë™ë‘ì²œì‹œ", "ê³¼ì²œì‹œ", "ê°€í‰êµ°", "ì—°ì²œêµ°", "ì•ˆì„±ì‹œ"],
      "ê²½ìƒë‚¨ë„": ["ì°½ì›ì‹œ", "ì§„ì£¼ì‹œ", "í†µì˜ì‹œ", "ì‚¬ì²œì‹œ", "ê¹€í•´ì‹œ", "ë°€ì–‘ì‹œ", "ê±°ì œì‹œ", "ì–‘ì‚°ì‹œ", "ì˜ë ¹êµ°", "í•¨ì•ˆêµ°", "ì°½ë…•êµ°", "ê³ ì„±êµ°", "ë‚¨í•´êµ°", "í•˜ë™êµ°", "ì‚°ì²­êµ°", "í•¨ì–‘êµ°", "ê±°ì°½êµ°", "í•©ì²œêµ°"],
      "ê²½ìƒë¶ë„": ["í¬í•­ì‹œ", "ê²½ì£¼ì‹œ", "ê¹€ì²œì‹œ", "ì•ˆë™ì‹œ", "êµ¬ë¯¸ì‹œ", "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "ìƒì£¼ì‹œ", "ë¬¸ê²½ì‹œ", "ê²½ì‚°ì‹œ", "êµ°ìœ„êµ°", "ì˜ì„±êµ°", "ì²­ì†¡êµ°", "ì˜ì–‘êµ°", "ì˜ë•êµ°", "ì²­ë„êµ°", "ê³ ë ¹êµ°", "ì„±ì£¼êµ°", "ì¹ ê³¡êµ°", "ì˜ˆì²œêµ°", "ë´‰í™”êµ°", "ìš¸ì§„êµ°", "ìš¸ë¦‰êµ°"],
      "ê´‘ì£¼ê´‘ì—­ì‹œ": ["ë™êµ¬", "ì„œêµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "ê´‘ì‚°êµ¬"],
      "ëŒ€êµ¬ê´‘ì—­ì‹œ": ["ì¤‘êµ¬", "ë™êµ¬", "ì„œêµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "ìˆ˜ì„±êµ¬", "ë‹¬ì„œêµ¬", "ë‹¬ì„±êµ°"],
      "ëŒ€ì „ê´‘ì—­ì‹œ": ["ë™êµ¬", "ì¤‘êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ëŒ€ë•êµ¬"],
      "ë¶€ì‚°ê´‘ì—­ì‹œ": ["ì¤‘êµ¬", "ì„œêµ¬", "ë™êµ¬", "ì˜ë„êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë™ë˜êµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "í•´ìš´ëŒ€êµ¬", "ì‚¬í•˜êµ¬", "ê¸ˆì •êµ¬", "ê°•ì„œêµ¬", "ì—°ì œêµ¬", "ìˆ˜ì˜êµ¬", "ì‚¬ìƒêµ¬", "ê¸°ì¥êµ°"],
      "ì„œìš¸íŠ¹ë³„ì‹œ": ["ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ìš©ì‚°êµ¬", "ì„±ë™êµ¬", "ê´‘ì§„êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ì¤‘ë‘êµ¬", "ì„±ë¶êµ¬", "ê°•ë¶êµ¬", "ë„ë´‰êµ¬", "ë…¸ì›êµ¬", "ì€í‰êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ë§ˆí¬êµ¬", "ì–‘ì²œêµ¬", "ê°•ì„œêµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ì˜ë“±í¬êµ¬", "ë™ì‘êµ¬", "ê´€ì•…êµ¬", "ì„œì´ˆêµ¬", "ê°•ë‚¨êµ¬", "ì†¡íŒŒêµ¬", "ê°•ë™êµ¬"],
      "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": ["ì„¸ì¢…ì‹œ"],
      "ìš¸ì‚°ê´‘ì—­ì‹œ": ["ì¤‘êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ìš¸ì£¼êµ°"],
      "ì¸ì²œê´‘ì—­ì‹œ": ["ì¤‘êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ì—°ìˆ˜êµ¬", "ë‚¨ë™êµ¬", "ë¶€í‰êµ¬", "ê³„ì–‘êµ¬", "ì„œêµ¬", "ê°•í™”êµ°", "ì˜¹ì§„êµ°"],
      "ì „ë¼ë‚¨ë„": ["ëª©í¬ì‹œ", "ì—¬ìˆ˜ì‹œ", "ìˆœì²œì‹œ", "ë‚˜ì£¼ì‹œ", "ê´‘ì–‘ì‹œ", "ë‹´ì–‘êµ°", "ê³¡ì„±êµ°", "êµ¬ë¡€êµ°", "ê³ í¥êµ°", "ë³´ì„±êµ°", "í™”ìˆœêµ°", "ì¥í¥êµ°", "ê°•ì§„êµ°", "í•´ë‚¨êµ°", "ì˜ì•”êµ°", "ë¬´ì•ˆêµ°", "í•¨í‰êµ°", "ì˜ê´‘êµ°", "ì¥ì„±êµ°", "ì™„ë„êµ°", "ì§„ë„êµ°", "ì‹ ì•ˆêµ°"],
      "ì „ë¼ë¶ë„": ["ì „ì£¼ì‹œ", "êµ°ì‚°ì‹œ", "ìµì‚°ì‹œ", "ì •ìì‹œ", "ë‚¨ì›ì‹œ", "ê¹€ì œì‹œ", "ì™„ì£¼êµ°", "ì§„ì•ˆêµ°", "ë¬´ì£¼êµ°", "ì¥ìˆ˜êµ°", "ì„ì‹¤êµ°", "ìˆœì°½êµ°", "ê³ ì°½êµ°", "ë¶€ì•ˆêµ°"],
      "ì œì£¼íŠ¹ë³„ìì¹˜ë„": ["ì œì£¼ì‹œ", "ì„œê·€í¬ì‹œ"],
      "ì¶©ì²­ë‚¨ë„": ["ì²œì•ˆì‹œ", "ê³µì£¼ì‹œ", "ë³´ë ¹ì‹œ", "ì•„ì‚°ì‹œ", "ì„œì‚°ì‹œ", "ë…¼ì‚°ì‹œ", "ê³„ë£¡ì‹œ", "ë‹¹ì§„ì‹œ", "ê¸ˆì‚°êµ°", "ë¶€ì—¬êµ°", "ì„œì²œêµ°", "ì²­ì–‘êµ°", "í™ì„±êµ°", "ì˜ˆì‚°êµ°", "íƒœì•ˆêµ°"],
      "ì¶©ì²­ë¶ë„": ["ì²­ì£¼ì‹œ", "ì¶©ì£¼ì‹œ", "ì œì²œì‹œ", "ë³´ì€êµ°", "ì˜¥ì²œêµ°", "ì˜ë™êµ°", "ì§„ì²œêµ°", "ê´´ì‚°êµ°", "ìŒì„±êµ°", "ë‹¨ì–‘êµ°", "ì¦í‰êµ°"]
    };

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', async () => {
      showLoading('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...');
      
      try {
        // ì¶œìƒì§€ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        populateSiDropdown();

        // Firebaseì—ì„œ í…œí”Œë¦¿ ë¡œë“œ ì‹œë„ (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
        await loadTemplates();

        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œë„ (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
        await loadScripts();

      } catch (error) {
        console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
      } finally {
        hideLoading();
      }
    });

    function showLoading(message) {
      const overlay = document.getElementById('loading-overlay');
      const status = document.getElementById('loading-status');
      status.textContent = message;
      overlay.classList.add('show');
    }

    function hideLoading() {
      const overlay = document.getElementById('loading-overlay');
      overlay.classList.remove('show');
    }

    // í…œí”Œë¦¿ ë¡œë“œ
    async function loadTemplates() {
      try {
        showLoading('í…œí”Œë¦¿ ë¡œë“œ ì¤‘...');
        
        // block1 ë¡œë“œ (ê²°ê³¼ í‘œì‹œìš©)
        try {
          const block1Response = await fetch(`${FIREBASE_API}/getTemplate?name=block1`, {
            method: 'GET',
            mode: 'cors'
          });
          if (block1Response.ok) {
            const block1HTML = await block1Response.text();
            document.getElementById('block1-container').innerHTML = block1HTML;
            console.log('âœ… block1 ë¡œë“œ ì„±ê³µ');
          }
        } catch (error) {
          console.warn('âš ï¸ block1 ë¡œë“œ ì‹¤íŒ¨:', error);
        }

        // block2 ë¡œë“œ (ê²°ê³¼ í‘œì‹œìš©)
        try {
          const block2Response = await fetch(`${FIREBASE_API}/getTemplate?name=block2`, {
            method: 'GET',
            mode: 'cors'
          });
          if (block2Response.ok) {
            const block2HTML = await block2Response.text();
            document.getElementById('block2-container').innerHTML = block2HTML;
            console.log('âœ… block2 ë¡œë“œ ì„±ê³µ');
          }
        } catch (error) {
          console.warn('âš ï¸ block2 ë¡œë“œ ì‹¤íŒ¨:', error);
        }

        console.log('í…œí”Œë¦¿ ë¡œë“œ ì™„ë£Œ');
      } catch (error) {
        console.error('í…œí”Œë¦¿ ë¡œë“œ ì—ëŸ¬:', error);
        // ì—ëŸ¬ê°€ ìˆì–´ë„ ê³„ì† ì§„í–‰
      }
    }

    // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ
    async function loadScripts() {
      const scripts = [
        'script_ui',
        'script_block3',
        'script_block3_1',
        'script_block3_2',
        'script_block3_4',
        'script_block4',
        'script_block4_daewoon',
        'script_block4_sewoon',
        'script_block6',
        'script_block7'
      ];

      for (const scriptName of scripts) {
        try {
          showLoading(`${scriptName} ë¡œë“œ ì¤‘...`);
          const response = await fetch(`${FIREBASE_API}/getTemplate?name=${scriptName}`);
          if (!response.ok) {
            console.warn(`${scriptName} ë¡œë“œ ì‹¤íŒ¨ - ê³„ì† ì§„í–‰`);
            continue;
          }
          
          const scriptHTML = await response.text();
          
          const div = document.createElement('div');
          div.innerHTML = scriptHTML;
          const scriptTags = div.querySelectorAll('script');
          
          scriptTags.forEach(oldScript => {
            const newScript = document.createElement('script');
            if (oldScript.src) {
              newScript.src = oldScript.src;
            } else {
              newScript.textContent = oldScript.textContent;
            }
            document.body.appendChild(newScript);
          });
          
          console.log(`${scriptName} ë¡œë“œ ì™„ë£Œ`);
        } catch (error) {
          console.error(`${scriptName} ë¡œë“œ ì—ëŸ¬:`, error);
        }
      }
    }

    // ì¶œìƒì§€ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    function populateSiDropdown() {
      const siSelect = document.getElementById("birth-si");
      for (const si in birthPlaceData) {
        const option = document.createElement("option");
        option.value = si;
        option.text = si;
        siSelect.appendChild(option);
      }
    }

    // êµ¬/êµ° ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateGunOptions() {
      const si = document.getElementById("birth-si").value;
      const gunSelect = document.getElementById("birth-gun");

      gunSelect.innerHTML = '<option value="">-- êµ¬/êµ° ì„ íƒ --</option>';

      if (si && birthPlaceData[si]) {
        birthPlaceData[si].forEach(gun => {
          const option = document.createElement("option");
          option.value = gun;
          option.text = gun;
          gunSelect.appendChild(option);
        });
      }
    }

    // ì‚¬ì£¼ ê³„ì‚° í•¨ìˆ˜
    async function submitToSheet() {
      const name = document.getElementById("name").value.trim();
      const gender = document.querySelector('input[name="gender"]:checked').value;
      const birthDate = document.getElementById("birthDate").value.trim();
      const birthTime = document.getElementById("birthTime").value.trim();
      const si = document.getElementById("birth-si").value;
      const gun = document.getElementById("birth-gun").value;

      // ìœ íš¨ì„± ê²€ì‚¬
      if (!name || !birthDate || !birthTime || !si || !gun) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      if (birthDate.length !== 8 || isNaN(birthDate)) {
        alert("ìƒë…„ì›”ì¼ì€ 8ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 19900115)");
        return;
      }

      if (birthTime.length !== 4 || isNaN(birthTime)) {
        alert("ì¶œìƒì‹œê°„ì€ 4ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 1430)");
        return;
      }

      // ë¡œë”© í‘œì‹œ
      document.getElementById("loading-message").style.display = "block";
      document.getElementById("error-message").style.display = "none";

      try {
        const formData = {
          name: name,
          gender: gender,
          birthdate: birthDate,
          birthtime: birthTime,
          lunar: false,
          si: si,
          gun: gun
        };

        const response = await fetch(`${FIREBASE_API}/calculateSaju`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
          // ê²°ê³¼ í‘œì‹œ
          displayResult(result);
          
          // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
          document.getElementById("form-section").style.display = "none";
          document.getElementById("result-section").style.display = "block";
        } else {
          throw new Error(result.error || 'ì‚¬ì£¼ ê³„ì‚°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }

      } catch (error) {
        console.error('Error:', error);
        document.getElementById("error-message").textContent = 
          'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
        document.getElementById("error-message").style.display = "block";
      } finally {
        document.getElementById("loading-message").style.display = "none";
      }
    }

    // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ (ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜ë  ê²ƒì„)
    function displayResult(result) {
      // ì´ í•¨ìˆ˜ëŠ” ë¡œë“œëœ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜ë©ë‹ˆë‹¤
      if (typeof window.displaySajuResult === 'function') {
        window.displaySajuResult(result);
      } else {
        console.log('ì‚¬ì£¼ ê²°ê³¼:', result);
      }
    }

    // ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (ì¼ë°˜ ì‚¬ìš©ììš© - ë¹„ë°€ë²ˆí˜¸ ë¶ˆí•„ìš”)
    async function searchResultByName() {
      const searchName = document.getElementById("search-name").value.trim();
      
      if (!searchName) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      try {
        // ì¼ë°˜ ì‚¬ìš©ìëŠ” ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ê²€ìƒ‰
        const response = await fetch(
          `${FIREBASE_API}/searchPublic?name=${encodeURIComponent(searchName)}`
        );
        const data = await response.json();

        if (data.success && data.result) {
          displayResult(data.result);
          document.getElementById("form-section").style.display = "none";
          document.getElementById("result-section").style.display = "block";
        } else {
          alert("í•´ë‹¹ ì´ë¦„ì˜ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.");
        }
      } catch (error) {
        console.error('ê²€ìƒ‰ ì—ëŸ¬:', error);
        alert("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    // ì €ì¥ëœ ê²°ê³¼ ë¡œë“œ
    async function loadSavedResult(name) {
      document.getElementById("search-name").value = name;
      await searchResultByName();
    }

    // ğŸŒŸ í´ë¦­ ì´ë²¤íŠ¸ (ê´€ë¦¬ì ëª¨ë“œ)
    setTimeout(() => {
      const star = document.getElementById("title-star");
      if (star) {
        star.addEventListener("click", async function () {
          const pwd = prompt("ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
          if (pwd) {
            // Firebaseì—ì„œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
            try {
              const response = await fetch(`${FIREBASE_API}/getSavedNames?password=${encodeURIComponent(pwd)}`);
              const data = await response.json();
              
              if (data.success) {
                document.getElementById("name-box").style.display = "flex";
                displaySavedNames(data.names);
                alert("âœ… ì£¼ì¸ì¥ ëª¨ë“œ: ì €ì¥ëœ ì´ë¦„ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
              } else {
                alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
              }
            } catch (error) {
              alert("âŒ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          }
        });
      }
    }, 1000);

    // ì €ì¥ëœ ì´ë¦„ í‘œì‹œ
    function displaySavedNames(names) {
      const nameBox = document.getElementById("name-box");
      nameBox.innerHTML = '';

      if (names && names.length > 0) {
        names.forEach(name => {
          const btn = document.createElement("button");
          btn.className = "small-button";
          btn.textContent = name;
          btn.onclick = () => loadSavedResult(name);
          nameBox.appendChild(btn);
        });
      }
    }
  </script>
</body>
</html>
